# Migration `20200928190640-withdraw-model`

This migration has been generated by Zane Helton at 9/28/2020, 3:06:40 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Withdraw" (
"id" text   NOT NULL ,
"approved" boolean   NOT NULL DEFAULT false,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"confirmToken" text   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_PromoCodeToTransaction" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "_PromoCodeToTransaction_AB_unique" ON "public"."_PromoCodeToTransaction"("A", "B")

CREATE INDEX "_PromoCodeToTransaction_B_index" ON "public"."_PromoCodeToTransaction"("B")

ALTER TABLE "public"."Withdraw" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_PromoCodeToTransaction" ADD FOREIGN KEY ("A")REFERENCES "public"."PromoCode"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_PromoCodeToTransaction" ADD FOREIGN KEY ("B")REFERENCES "public"."Transaction"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200928023541-non-opt-passwordreset..20200928190640-withdraw-model
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 model User {
   id                 String        @default(uuid()) @id
@@ -24,8 +24,9 @@
   reviews            Review[]
   transactions       Transaction[]
   updatedAt          DateTime      @updatedAt
   username           String        @unique
+  withdraws          Withdraw[]
   // balance
   unpaidBalance Float @default(0)
   paidBalance   Float @default(0)
@@ -56,21 +57,22 @@
   promoCodes   PromoCode[]
 }
 model Transaction {
-  id              String    @default(uuid()) @id
-  amount          Float     @default(0)
-  approved        Boolean   @default(false)
-  buyer           User?     @relation(fields: [buyerId], references: [id])
+  id              String      @default(uuid()) @id
+  amount          Float       @default(0)
+  approved        Boolean     @default(false)
+  buyer           User?       @relation(fields: [buyerId], references: [id])
   buyerId         String?
-  createdAt       DateTime  @default(now())
+  createdAt       DateTime    @default(now())
   email           String?
-  licenseKey      String?   @unique
-  licenseRedeemed Boolean   @default(false)
-  licenseKeyShown Int       @default(0)
+  licenseKey      String?     @unique
+  licenseRedeemed Boolean     @default(false)
+  licenseKeyShown Int         @default(0)
   paypalPaymentId String?
   products        Product[]
-  updatedAt       DateTime  @updatedAt
+  updatedAt       DateTime    @updatedAt
+  promos          PromoCode[]
 }
 model Tag {
   id        String    @default(uuid()) @id
@@ -114,18 +116,28 @@
   product    Product
 }
 model PromoCode {
-  id         String    @default(uuid()) @id
-  createdAt  DateTime  @default(now())
-  isArchived Boolean   @default(false)
-  affectsAll Boolean
-  code       String    @unique
-  expiresAt  DateTime?
-  percentOff Int
-  product    Product?  @relation(fields: [productId], references: [id])
-  productId  String?
-  useLimit   Int?
-  uses       Int       @default(0)
-  user       User      @relation(fields: [userId], references: [id])
-  userId     String
+  id           String        @default(uuid()) @id
+  createdAt    DateTime      @default(now())
+  isArchived   Boolean       @default(false)
+  affectsAll   Boolean
+  code         String        @unique
+  expiresAt    DateTime?
+  percentOff   Int
+  product      Product?      @relation(fields: [productId], references: [id])
+  productId    String?
+  useLimit     Int?
+  uses         Int           @default(0)
+  user         User          @relation(fields: [userId], references: [id])
+  userId       String
+  transactions Transaction[]
 }
+
+model Withdraw {
+  id           String   @default(uuid()) @id
+  approved     Boolean  @default(false)
+  createdAt    DateTime @default(now())
+  confirmToken String   @default(cuid())
+  user         User     @relation(fields: [userId], references: [id])
+  userId       String
+}
```


