# Migration `20200926202121-add-promo-code`

This migration has been generated by Zane Helton at 9/26/2020, 4:21:21 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."PromoCode" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"isArchived" boolean   NOT NULL DEFAULT false,
"code" text   NOT NULL ,
"expires" timestamp(3)   ,
"productId" text   NOT NULL ,
"useLimit" integer   ,
"uses" integer   NOT NULL DEFAULT 0,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "PromoCode.code_unique" ON "public"."PromoCode"("code")

ALTER TABLE "public"."PromoCode" ADD FOREIGN KEY ("productId")REFERENCES "public"."Product"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200926033213-add-balance-to-user..20200926202121-add-promo-code
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 model User {
   id            String        @default(uuid()) @id
@@ -49,8 +49,9 @@
   images       Image[]
   isArchived   Boolean       @default(false)
   file         File?         @relation(fields: [fileId], references: [id])
   fileId       String?
+  promoCodes   PromoCode[]
 }
 model Transaction {
   id              String    @default(uuid()) @id
@@ -108,4 +109,16 @@
   secret     String   @unique
   url        String   @unique
   product    Product
 }
+
+model PromoCode {
+  id         String    @default(uuid()) @id
+  createdAt  DateTime  @default(now())
+  isArchived Boolean   @default(false)
+  code       String    @unique
+  expires    DateTime?
+  product    Product   @relation(fields: [productId], references: [id])
+  productId  String
+  useLimit   Int?
+  uses       Int       @default(0)
+}
```


