# Migration `20201008035601-fixed-favorites`

This migration has been generated by Zane Helton at 10/7/2020, 11:56:02 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Product" DROP CONSTRAINT "Product_userId_fkey"

ALTER TABLE "public"."Product" DROP COLUMN "userId"

CREATE TABLE "public"."_Favorites" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "_Favorites_AB_unique" ON "public"."_Favorites"("A", "B")

CREATE INDEX "_Favorites_B_index" ON "public"."_Favorites"("B")

ALTER TABLE "public"."_Favorites" ADD FOREIGN KEY ("A")REFERENCES "public"."Product"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_Favorites" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201008035453-add-favorites..20201008035601-fixed-favorites
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 enum AccountType {
   FREE
@@ -68,10 +68,9 @@
   file         File?         @relation(fields: [fileId], references: [id])
   fileId       String?
   promoCodes   PromoCode[]
   payouts      Payout[]
-  User         User?         @relation("Favorites", fields: [userId], references: [id])
-  userId       String?
+  users        User[]        @relation("Favorites", references: [id])
 }
 model Transaction {
   id              String      @id @default(uuid())
```


