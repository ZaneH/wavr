# Migration `20201005235339-generic-payouts`

This migration has been generated by Zane Helton at 10/5/2020, 7:53:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."PlatformPayment" DROP CONSTRAINT "PlatformPayment_productId_fkey"

ALTER TABLE "public"."PlatformPayment" DROP CONSTRAINT "PlatformPayment_transactionId_fkey"

CREATE TABLE "public"."Payout" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"amount" Decimal(65,30)   NOT NULL DEFAULT 0,
"userId" text   ,
"forPlatform" boolean   NOT NULL ,
"productId" text   NOT NULL ,
"transactionId" text   NOT NULL ,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."Payout" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Payout" ADD FOREIGN KEY ("productId")REFERENCES "public"."Product"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Payout" ADD FOREIGN KEY ("transactionId")REFERENCES "public"."Transaction"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."PlatformPayment"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201005234912-add-platform-payment..20201005235339-generic-payouts
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 enum AccountType {
   FREE
@@ -33,8 +33,9 @@
   reviews            Review[]
   transactions       Transaction[]
   updatedAt          DateTime      @updatedAt
   username           String        @unique
+  payouts            Payout[]
   withdraws          Withdraw[]
   // balance
   unpaidBalance Float @default(0)
@@ -45,54 +46,58 @@
   emailUpdates Boolean @default(true)
 }
 model Product {
-  id              String            @id @default(uuid())
-  amount          Float             @default(0)
-  createdAt       DateTime          @default(now())
-  description     String
-  name            String
-  onSale          Boolean           @default(false)
-  salePrice       Float?
-  owner           User?             @relation(fields: [ownerId], references: [id])
-  ownerId         String?
-  reviews         Review[]
-  tags            Tag[]
-  transactions    Transaction[]
-  updatedAt       DateTime          @updatedAt
-  images          Image[]
-  isArchived      Boolean           @default(false)
-  file            File?             @relation(fields: [fileId], references: [id])
-  fileId          String?
-  promoCodes      PromoCode[]
+  id           String        @id @default(uuid())
+  amount       Float         @default(0)
+  createdAt    DateTime      @default(now())
+  description  String
+  name         String
+  onSale       Boolean       @default(false)
+  salePrice    Float?
+  owner        User?         @relation(fields: [ownerId], references: [id])
+  ownerId      String?
+  reviews      Review[]
+  tags         Tag[]
+  transactions Transaction[]
+  updatedAt    DateTime      @updatedAt
+  images       Image[]
+  isArchived   Boolean       @default(false)
+  file         File?         @relation(fields: [fileId], references: [id])
+  fileId       String?
+  promoCodes   PromoCode[]
+  payouts      Payout[]
 }
 model Transaction {
-  id              String            @id @default(uuid())
-  amount          Float             @default(0)
-  approved        Boolean           @default(false)
-  buyer           User?             @relation(fields: [buyerId], references: [id])
+  id              String      @id @default(uuid())
+  amount          Float       @default(0)
+  approved        Boolean     @default(false)
+  buyer           User?       @relation(fields: [buyerId], references: [id])
   buyerId         String?
-  createdAt       DateTime          @default(now())
+  createdAt       DateTime    @default(now())
   email           String?
-  licenseKey      String?           @unique
-  licenseRedeemed Boolean           @default(false)
-  licenseKeyShown Int               @default(0)
+  licenseKey      String?     @unique
+  licenseRedeemed Boolean     @default(false)
+  licenseKeyShown Int         @default(0)
   paypalPaymentId String?
   products        Product[]
-  updatedAt       DateTime          @updatedAt
+  updatedAt       DateTime    @updatedAt
   promos          PromoCode[]
-  PlatformPayment PlatformPayment[]
+  payouts         Payout[]
 }
-model PlatformPayment {
+model Payout {
   id            String      @id @default(uuid())
   createdAt     DateTime    @default(now())
   amount        Float       @default(0)
+  user          User?       @relation(fields: [userId], references: [id])
+  userId        String?
+  forPlatform   Boolean
   product       Product     @relation(fields: [productId], references: [id])
+  productId     String
   transaction   Transaction @relation(fields: [transactionId], references: [id])
   transactionId String
-  productId     String
 }
 model Tag {
   id        String    @id @default(uuid())
```


